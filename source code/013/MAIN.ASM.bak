;This code is de'assemblered by HOLYCHIP shanghai Ltd.. 
;Soft version 1.02
;Thanks for using, find any bug, please report it to HC!

          #include "HC18P013.inc"
          list p = 18P013, R=DEC
;********************************************
;               RAM  START                  
;******************************************** 
;;;;;;;;;;;;;;;4M 2T


          DATA	
;;CONST          
#Define PORTA_INI	b'00000000'	; PORTA端口初值 
#Define PORTB_INI	b'00000110'	; PORTB端口初值  

#Define TRISA_INI	b'00000000'	; PORTA方向初值  0 输出 1输入
#Define TRISB_INI	b'00001001'	; PORTB方向初值

#Define PHCON_INI	b'11111110'	; 上拉 0 使能 1禁止
#Define PDCON_INI	b'11111111'	; 下拉 0 使能 1禁止 
#Define ODCON_INI	b'00000000'	; 开漏输出      1 使能 0禁止

#Define	OPTION_INI	b'10000000'	; X 上升沿下降沿 T0时钟源 T0计数沿选择 分频器派送 T0预分频1:2
#DEFINE T0_INI	        156		; 4m4t，200us

#DEFINE	PCON_INI	B'10111000'     ;WDT使能   外部int禁止	        
#DEFINE	IOCB_INI	B'00000000'     ;PB 中断和唤醒 0 禁止

#DEFINE	INTECON_INI	B'10000001'     ;WDT使能   外部int禁止	 

;;;IO DEFINE HERE


;--------------------

#Define C_RAM_START		0x10
#Define C_RAM_END		0xC0

;RAM define here  优先使用20~3f空间 
HIGHCOUNT		EQU	0X20
HIGHCOUNT1		EQU	0X21

LOWCOUNT		EQU	0X22
LOWCOUNT1		EQU	0X23
FLAG_BYTE		EQU	0X24
#DEFINE		F_FLASH_BIT	FLAG_BYTE,0
#DEFINE		F_2MS_BIT	FLAG_BYTE,1
#DEFINE		F_FIRST_BIT	FLAG_BYTE,2
COUNT_200US		EQU	0X25
COUNT_200US1		EQU	0X26
COUNT_200US2		EQU	0X27

PCLATH_TEMP	    	EQU       0X3D 
STATUS_TEMP     	EQU       0X3E
W_TEMP          	EQU       0X3F             
	

;********************************************
;               CODE START                  
;********************************************
        CODE

        ORG     0000H	
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP        
        GOTO    RESET        
                
        ORG     0008H  							
INTPROGRAM:		

	MOVWF	W_TEMP
	SWAPF	W_TEMP,F	; SAVE W
	SWAPF	STATUS,W
	MOVWF	STATUS_TEMP	; SAVE STATUS
        ;MOVF    PCLATH,W
        ;MOVWF   PCLATH_TEMP	  
		
	BTFSS	T0IF		;200us
	GOTO	INT_EXIT
	BCF	T0IF
	
	MOVLW	T0_INI
	MOVWF	T0
	
TIMEFLAG:
	
	INCF	COUNT_200US,F
	MOVLW	D'10'
	SUBWF	COUNT_200US,W
	BTFSS	C
	GOTO	INT_EXIT
	CLRF	COUNT_200US
	BSF	F_2MS_BIT	

INT_EXIT:
        ;MOVF    PCLATH_TEMP,W
        ;MOVWF   PCLATH										
	SWAPF	STATUS_TEMP, W
	MOVWF	STATUS				;恢复STATUS
        SWAPF	W_TEMP, W			;恢复W		
	RETFIE			
;***************************************  	   
RESET:   
        CLRF    INTECON
        CLRF    INTFLAG
	CLRF	PCON    
	CLRWDT
 
;***************************************   
	
;***************************************      
;IO

	MOVLW	PORTA_INI
	MOVWF	PORTA
		
	MOVLW	TRISA_INI
	MOVWF	TRISA
		
	MOVLW	PORTB_INI
	MOVWF	PORTB

	MOVLW	TRISB_INI
	MOVWF	TRISB
	
	MOVLW	ODCON_INI
	MOVWF	ODCON	
	
	MOVLW	PHCON_INI
	MOVWF	PHCON	

	MOVLW	PDCON_INI
	MOVWF	PDCON
	
	MOVLW	IOCB_INI
	MOVWF	IOCB	
	
;***************************************	
;;;;;;CLRF RAM 自减
;;;;;
;;;;;#Define C_RAM_START	0x3f
;;;;;#Define C_RAM_END		0xd0
;;;;;        CLRF    TEMP_BUF
;;;;;	
;;;;;	MOVLW	C_RAM_START
;;;;;	MOVWF	FSR
;;;;;	
;;;;;_INI_RAM_Loop
;;;;;	CLRF	INDF
;;;;;	decf	FSR, F
;;;;;
;;;;;        MOVF    FSR,W
;;;;; ;       IORLW   C_RAM_END       ;比较时,需要将fsr的高两位置1,否则仿真编译可以过,烧出的芯片没错!这是自家的时候!
;;;;;	XORLW	C_RAM_END        ;自减清ram的时候,初值给3f,减到D0H,停止自减,然后再把D0H清一下!D0H相当于是10h!因为高两位是1.
;;;;;	BTFSS	Z                ;自加清ram的时候,初值给10h,判断到c0h停止自加,不用再请c0h,3f清完,加一就变成c0h了,相当于00h.
;;;;;	GOTO	_INI_RAM_Loop 
;;;;;	CLRF	INDF 
;;;;;	
;***************************************	
;CLRF RAM 自加
;#Define C_RAM_START		0x10
;#Define C_RAM_END		0xC0
        CLRF    0X07
	
	MOVLW	C_RAM_START
	MOVWF	FSR
	
_INI_RAM_Loop:
	CLRF	INDF
	INCF	FSR, F

        MOVF    FSR,W
	XORLW	C_RAM_END 
	BTFSS	Z         
	GOTO	_INI_RAM_Loop 
	
;***************************************	

;***************************************
;T0

	MOVLW	OPTION_INI		 
	MOVWF	OPTION

	MOVLW	T0_INI
        MOVWF   T0

	BCF	T0IF
	
	MOVLW	PCON_INI
	MOVWF	PCON
	
	MOVLW   INTECON_INI
	MOVWF   INTECON
	
;┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
;┃主循环							 ┃
;┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
MAINLOOP:

	CLRWDT	         
	
	GOTO	MAINLOOP
;-----------------------------------------------------
		
;********************************************  
;********************************************
        ORG     03FFH                   ; 飞凌的才有用!        
        GOTO    RESET                           
        END


;********************************************
;               CODE END                    
;********************************************
